{"version":3,"sources":["webpack:///./src/templates/view-book.js","webpack:///./.cache/public-page-renderer.js","webpack:///./.cache/gatsby-browser-entry.js","webpack:///./.cache/public-page-renderer-prod.js"],"names":["window","PDFJS","workerSrc","ViewBook","props","_this","_Component","call","this","state","page","getInitialPageCount","fullscreen","nextPage","bind","_babel_runtime_helpers_assertThisInitialized__WEBPACK_IMPORTED_MODULE_1___default","prevPage","navigate","toggleFullscreen","localStorage","fingerprint","data","book","getItem","storeCurrentPage","setItem","setState","pageCount","event","bounds","target","getBoundingClientRect","clientX","left","Math","floor","width","componentDidMount","getDocument","downloadPath","promise","then","pdf","renderPage","componentDidUpdate","getPage","viewport","getViewport","canvas","document","getElementById","context","getContext","height","renderContext","canvasContext","render","bookViewClassnames","classNames","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","className","title","href","gatsby_link__WEBPACK_IMPORTED_MODULE_3___default","to","author","onClick","disabled","id","Component","query","m","module","exports","require","default","__webpack_require__","r","__webpack_exports__","d","graphql","StaticQueryContext","StaticQuery","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","prop_types__WEBPACK_IMPORTED_MODULE_1__","prop_types__WEBPACK_IMPORTED_MODULE_1___default","gatsby_link__WEBPACK_IMPORTED_MODULE_2__","gatsby_link__WEBPACK_IMPORTED_MODULE_2___default","_public_page_renderer__WEBPACK_IMPORTED_MODULE_3__","_public_page_renderer__WEBPACK_IMPORTED_MODULE_3___default","_parse_path__WEBPACK_IMPORTED_MODULE_4__","React","createContext","Consumer","staticQueryData","children","Error","propTypes","PropTypes","object","string","isRequired","func","ProdPageRenderer","_ref","location","pageResources","loader","getResourcesForPathnameSync","pathname","InternalPageRenderer","Object","assign","json","shape"],"mappings":"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","file":"component---src-templates-view-book-js-60d527370cca3e0c5617.js","sourcesContent":["import React, { Component } from 'react'\nimport Link from 'gatsby-link'\nimport PDFJS from 'pdfjs-dist'\nimport classNames from 'classnames'\n\nimport * as styles from './ViewBook.css'\n\nif (typeof window !== 'undefined') {\n  window.PDFJS = PDFJS\n  window.PDFJS.workerSrc = '/pdf.worker.js'\n}\n\nexport default class ViewBook extends Component {\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      page: this.getInitialPageCount(),\n      fullscreen: false,\n    }\n\n    this.nextPage = this.nextPage.bind(this)\n    this.prevPage = this.prevPage.bind(this)\n    this.navigate = this.navigate.bind(this)\n    this.toggleFullscreen = this.toggleFullscreen.bind(this)\n  }\n\n  getInitialPageCount() {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      const fingerprint = this.props.data.book.fingerprint\n      return +window.localStorage.getItem(`currentPage:${fingerprint}`) || 1\n    }\n  }\n\n  storeCurrentPage() {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      const fingerprint = this.props.data.book.fingerprint\n      window.localStorage.setItem(`currentPage:${fingerprint}`, this.state.page)\n    }\n  }\n\n  toggleFullscreen() {\n    this.setState({ fullscreen: !this.state.fullscreen })\n  }\n\n  nextPage() {\n    const nextPage = (this.state.page += 1)\n\n    if (nextPage < 1) {\n      return\n    }\n\n    this.setState({\n      page: nextPage,\n    })\n  }\n\n  prevPage() {\n    const nextPage = (this.state.page -= 1)\n\n    if (this.state.page >= this.props.data.book.pageCount) {\n      return\n    }\n\n    this.setState({\n      page: nextPage,\n    })\n  }\n\n  navigate(event) {\n    const bounds = event.target.getBoundingClientRect()\n    const x = event.clientX - bounds.left\n    const halfPoint = Math.floor(bounds.width / 2)\n\n    if (x < halfPoint) {\n      this.prevPage()\n    } else {\n      this.nextPage()\n    }\n  }\n\n  componentDidMount() {\n    const loadingTask = PDFJS.getDocument(this.props.data.book.downloadPath)\n\n    loadingTask.promise.then(\n      function(pdf) {\n        this.pdf = pdf\n\n        this.renderPage()\n      }.bind(this)\n    )\n  }\n\n  componentDidUpdate() {\n    this.renderPage()\n    this.storeCurrentPage()\n  }\n\n  renderPage() {\n    this.pdf.getPage(this.state.page).then(function(page) {\n      const scale = 1.5\n      const viewport = page.getViewport(scale)\n\n      // Prepare canvas using PDF page dimensions\n      const canvas = document.getElementById('book-canvas')\n      const context = canvas.getContext('2d')\n      canvas.height = viewport.height\n      canvas.width = viewport.width\n\n      // Render PDF page into canvas context\n      var renderContext = {\n        canvasContext: context,\n        viewport: viewport,\n      }\n\n      page.render(renderContext)\n    })\n  }\n\n  render() {\n    const book = this.props.data.book\n    const bookViewClassnames = classNames('book-view', {\n      fullscreen: this.state.fullscreen,\n    })\n\n    return (\n      <div>\n        <header className=\"book-headline\">\n          <h1 className=\"title\">{book.title}</h1>\n          <a href={book.downloadPath} className=\"download-link\">\n            &#9196;\n          </a>\n        </header>\n\n        <Link className=\"back-link\" to=\"/\">\n          Home\n        </Link>\n\n        <p className=\"author\">Author: {book.author}</p>\n\n        <section className={bookViewClassnames}>\n          <div className=\"controls\">\n            <button onClick={this.prevPage} disabled={this.state.page <= 1}>\n              Back\n            </button>\n\n            <p className=\"page-count\">\n              Page {this.state.page} of {book.pageCount}\n            </p>\n\n            <div className=\"controls-right\">\n              <button\n                onClick={this.nextPage}\n                disabled={this.state.page >= this.props.data.book.pageCount}\n              >\n                Next\n              </button>\n\n              <button onClick={this.toggleFullscreen}>\n                {this.state.fullscreen ? '▼' : '▲'}\n              </button>\n            </div>\n          </div>\n\n          <canvas id=\"book-canvas\" onClick={this.navigate} />\n        </section>\n      </div>\n    )\n  }\n}\n\nexport const query = graphql`\n  query BookQuery($path: String!) {\n    book(path: { eq: $path }) {\n      id\n      title\n      author\n      pageCount\n      downloadPath\n      fingerprint\n    }\n  }\n`\n","const preferDefault = m => (m && m.default) || m\n\nif (process.env.BUILD_STAGE === `develop`) {\n  module.exports = preferDefault(require(`./public-page-renderer-dev`))\n} else if (process.env.BUILD_STAGE === `build-javascript`) {\n  module.exports = preferDefault(require(`./public-page-renderer-prod`))\n} else {\n  module.exports = () => null\n}\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport Link, {\n  withPrefix,\n  navigate,\n  push,\n  replace,\n  navigateTo,\n} from \"gatsby-link\"\nimport PageRenderer from \"./public-page-renderer\"\nimport parsePath from \"./parse-path\"\n\nconst StaticQueryContext = React.createContext({})\n\nconst StaticQuery = props => (\n  <StaticQueryContext.Consumer>\n    {staticQueryData => {\n      if (\n        props.data ||\n        (staticQueryData[props.query] && staticQueryData[props.query].data)\n      ) {\n        return (props.render || props.children)(\n          props.data ? props.data.data : staticQueryData[props.query].data\n        )\n      } else {\n        return <div>Loading (StaticQuery)</div>\n      }\n    }}\n  </StaticQueryContext.Consumer>\n)\n\nStaticQuery.propTypes = {\n  data: PropTypes.object,\n  query: PropTypes.string.isRequired,\n  render: PropTypes.func,\n  children: PropTypes.func,\n}\n\nfunction graphql() {\n  throw new Error(\n    `It appears like Gatsby is misconfigured. Gatsby related \\`graphql\\` calls ` +\n      `are supposed to only be evaluated at compile time, and then compiled away,. ` +\n      `Unfortunately, something went wrong and the query was left in the compiled code.\\n\\n.` +\n      `Unless your site has a complex or custom babel/Gatsby configuration this is likely a bug in Gatsby.`\n  )\n}\n\nexport {\n  Link,\n  withPrefix,\n  graphql,\n  parsePath,\n  navigate,\n  push, // TODO replace for v3\n  replace, // TODO remove replace for v3\n  navigateTo, // TODO: remove navigateTo for v3\n  StaticQueryContext,\n  StaticQuery,\n  PageRenderer,\n}\n","import React from \"react\"\nimport PropTypes from \"prop-types\"\n\nimport InternalPageRenderer from \"./page-renderer\"\nimport loader from \"./loader\"\n\nconst ProdPageRenderer = ({ location }) => {\n  const pageResources = loader.getResourcesForPathnameSync(location.pathname)\n  return React.createElement(InternalPageRenderer, {\n    location,\n    pageResources,\n    ...pageResources.json,\n  })\n}\n\nProdPageRenderer.propTypes = {\n  location: PropTypes.shape({\n    pathname: PropTypes.string.isRequired,\n  }).isRequired,\n}\n\nexport default ProdPageRenderer\n"],"sourceRoot":""}